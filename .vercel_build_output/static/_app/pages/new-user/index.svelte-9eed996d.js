import{S as e,i as t,s as n,l as s,f as o,d as a,e as r,t as l,c,a as i,g as u,R as h,G as d,T as p,H as f,k as m,n as v,h as g,U as y,N as w,b as _,j as x,m as $,V as C,o as E,x as P,u as T,v as S,W as b,A as j,X as O,Y as N,L as I}from"../../chunks/vendor-c910c2b0.js";import{s as k}from"../../chunks/stores-75d53c29.js";import{S as U}from"../../chunks/SubmitButton-57b888ce.js";function A(e,t,n){const s=e.slice();return s[21]=t[n],s}function L(e,t,n){const s=e.slice();return s[24]=t[n],s}function H(e){let t,n,s,h=e[24].text+"";return{c(){t=r("option"),n=l(h),s=m(),this.h()},l(e){t=c(e,"OPTION",{});var o=i(t);n=u(o,h),s=v(o),o.forEach(a),this.h()},h(){t.__value=e[24].value,t.value=t.__value},m(e,a){o(e,t,a),d(t,n),d(t,s)},p:I,d(e){e&&a(t)}}}function R(e){let t,n="null";return{c(){t=l(n)},l(e){t=u(e,n)},m(e,n){o(e,t,n)},p:I,d(e){e&&a(t)}}}function V(e){let t;function n(e,t){return"teacher"===e[6].user.type&&"researcher"===e[24].value?R:H}let r=n(e),l=r(e);return{c(){l.c(),t=s()},l(e){l.l(e),t=s()},m(e,n){l.m(e,n),o(e,t,n)},p(e,s){r===(r=n(e))&&l?l.p(e,s):(l.d(1),l=r(e),l&&(l.c(),l.m(t.parentNode,t)))},d(e){l.d(e),e&&a(t)}}}function B(e){let t,n,s,m,v,g=e[0],_=[];for(let o=0;o<g.length;o+=1)_[o]=D(A(e,g,o));return{c(){t=r("select"),n=r("option"),s=l("Select a school");for(let e=0;e<_.length;e+=1)_[e].c();this.h()},l(e){t=c(e,"SELECT",{});var o=i(t);n=c(o,"OPTION",{});var r=i(n);s=u(r,"Select a school"),r.forEach(a);for(let t=0;t<_.length;t+=1)_[t].l(o);o.forEach(a),this.h()},h(){n.disabled=!0,n.selected=!0,n.__value="",n.value=n.__value,void 0===e[1].school_id&&h((()=>e[17].call(t)))},m(a,r){o(a,t,r),d(t,n),d(n,s);for(let e=0;e<_.length;e+=1)_[e].m(t,null);p(t,e[1].school_id),m||(v=[f(t,"change",e[17]),f(t,"change",e[18])],m=!0)},p(e,n){if(1&n){let s;for(g=e[0],s=0;s<g.length;s+=1){const o=A(e,g,s);_[s]?_[s].p(o,n):(_[s]=D(o),_[s].c(),_[s].m(t,null))}for(;s<_.length;s+=1)_[s].d(1);_.length=g.length}130&n&&p(t,e[1].school_id)},d(e){e&&a(t),y(_,e),m=!1,w(v)}}}function D(e){let t,n,s,h,p=e[21].name+"";return{c(){t=r("option"),n=l(p),s=m(),this.h()},l(e){t=c(e,"OPTION",{});var o=i(t);n=u(o,p),s=v(o),o.forEach(a),this.h()},h(){t.__value=h=e[21]._id,t.value=t.__value},m(e,a){o(e,t,a),d(t,n),d(t,s)},p(e,s){1&s&&p!==(p=e[21].name+"")&&g(n,p),1&s&&h!==(h=e[21]._id)&&(t.__value=h,t.value=t.__value)},d(e){e&&a(t)}}}function G(e){let t;return{c(){t=l("Add user")},l(e){t=u(e,"Add user")},m(e,n){o(e,t,n)},d(e){e&&a(t)}}}function J(e){let t,n;return{c(){t=r("p"),n=l(e[3]),this.h()},l(s){t=c(s,"P",{class:!0});var o=i(t);n=u(o,e[3]),o.forEach(a),this.h()},h(){_(t,"class","text-red-400")},m(e,s){o(e,t,s),d(t,n)},p(e,t){8&t&&g(n,e[3])},d(e){e&&a(t)}}}function W(e){let t,n;return{c(){t=r("p"),n=l(e[4]),this.h()},l(s){t=c(s,"P",{class:!0});var o=i(t);n=u(o,e[4]),o.forEach(a),this.h()},h(){_(t,"class","text-green-500")},m(e,s){o(e,t,s),d(t,n)},p(e,t){16&t&&g(n,e[4])},d(e){e&&a(t)}}}function X(e){let t,n,s,g,b,j,O,N,I,k,A,H,R,D,X,Y,q,z,F,K=e[7],M=[];for(let o=0;o<K.length;o+=1)M[o]=V(L(e,K,o));let Q="researcher"===e[6].user.type&&e[0]&&B(e);D=new U({props:{disabled:e[2],action:e[8],loading:e[5],$$slots:{default:[G]},$$scope:{ctx:e}}});let Z=e[3]&&J(e),ee=e[4]&&W(e);return{c(){t=r("div"),n=r("h1"),s=l("Create new user"),g=m(),b=r("input"),j=m(),O=r("input"),N=m(),I=r("input"),k=m(),A=r("select");for(let e=0;e<M.length;e+=1)M[e].c();H=m(),Q&&Q.c(),R=m(),x(D.$$.fragment),X=m(),Z&&Z.c(),Y=m(),ee&&ee.c(),this.h()},l(e){t=c(e,"DIV",{class:!0});var o=i(t);n=c(o,"H1",{});var r=i(n);s=u(r,"Create new user"),r.forEach(a),g=v(o),b=c(o,"INPUT",{type:!0,name:!0,placeholder:!0}),j=v(o),O=c(o,"INPUT",{type:!0,name:!0,placeholder:!0}),N=v(o),I=c(o,"INPUT",{type:!0,name:!0,placeholder:!0}),k=v(o),A=c(o,"SELECT",{});var l=i(A);for(let t=0;t<M.length;t+=1)M[t].l(l);l.forEach(a),H=v(o),Q&&Q.l(o),R=v(o),$(D.$$.fragment,o),X=v(o),Z&&Z.l(o),Y=v(o),ee&&ee.l(o),o.forEach(a),this.h()},h(){_(b,"type","text"),_(b,"name","username"),_(b,"placeholder","Username"),_(O,"type","password"),_(O,"name","username"),_(O,"placeholder","Password"),_(I,"type","password"),_(I,"name","passwordConfirmation"),_(I,"placeholder","Confirm password"),void 0===e[1].type&&h((()=>e[15].call(A))),_(t,"class","flex flex-col md:items-center gap-3")},m(a,r){o(a,t,r),d(t,n),d(n,s),d(t,g),d(t,b),C(b,e[1].username),d(t,j),d(t,O),C(O,e[1].password),d(t,N),d(t,I),C(I,e[1].passwordConfirmation),d(t,k),d(t,A);for(let e=0;e<M.length;e+=1)M[e].m(A,null);p(A,e[1].type),d(t,H),Q&&Q.m(t,null),d(t,R),E(D,t,null),d(t,X),Z&&Z.m(t,null),d(t,Y),ee&&ee.m(t,null),q=!0,z||(F=[f(b,"input",e[9]),f(b,"change",e[10]),f(O,"input",e[11]),f(O,"change",e[12]),f(I,"input",e[13]),f(I,"change",e[14]),f(A,"change",e[15]),f(A,"change",e[16])],z=!0)},p(e,[n]){if(130&n&&b.value!==e[1].username&&C(b,e[1].username),130&n&&O.value!==e[1].password&&C(O,e[1].password),130&n&&I.value!==e[1].passwordConfirmation&&C(I,e[1].passwordConfirmation),192&n){let t;for(K=e[7],t=0;t<K.length;t+=1){const s=L(e,K,t);M[t]?M[t].p(s,n):(M[t]=V(s),M[t].c(),M[t].m(A,null))}for(;t<M.length;t+=1)M[t].d(1);M.length=K.length}130&n&&p(A,e[1].type),"researcher"===e[6].user.type&&e[0]?Q?Q.p(e,n):(Q=B(e),Q.c(),Q.m(t,R)):Q&&(Q.d(1),Q=null);const s={};4&n&&(s.disabled=e[2]),32&n&&(s.loading=e[5]),134217728&n&&(s.$$scope={dirty:n,ctx:e}),D.$set(s),e[3]?Z?Z.p(e,n):(Z=J(e),Z.c(),Z.m(t,Y)):Z&&(Z.d(1),Z=null),e[4]?ee?ee.p(e,n):(ee=W(e),ee.c(),ee.m(t,null)):ee&&(ee.d(1),ee=null)},i(e){q||(P(D.$$.fragment,e),q=!0)},o(e){T(D.$$.fragment,e),q=!1},d(e){e&&a(t),y(M,e),Q&&Q.d(),S(D),Z&&Z.d(),ee&&ee.d(),z=!1,w(F)}}}var Y=function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(t){a(t)}}function l(e){try{c(s.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((s=s.apply(e,t||[])).next())}))};const q=({session:e})=>Y(void 0,void 0,void 0,(function*(){if(!e.user||"student"===e.user.type)return{status:302,redirect:"/login"};if("researcher"===e.user.type)try{const e=yield fetch("/api/school");if(e.ok){const t=yield e.json();return console.log("userres",t),{props:{schools:t.schools}}}}catch(t){console.error(t)}return{}}));function z(e,t,n){let s;b(e,k,(e=>n(6,s=e)));var o=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(o,a){function r(e){try{c(s.next(e))}catch(t){a(t)}}function l(e){try{c(s.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((s=s.apply(e,t||[])).next())}))};let a,r,{schools:l}=t,c={username:"",password:"",passwordConfirmation:"",type:"student",school_id:null},i=[{value:"student",text:"Student"},{value:"teacher",text:"Teacher"},{value:"researcher",text:"Researcher"}],u=!1,h=!1;j((()=>{console.log("schools",l)}));return e.$$set=e=>{"schools"in e&&n(0,l=e.schools)},[l,c,u,a,r,h,s,i,function(){return o(this,void 0,void 0,(function*(){n(3,a=void 0),n(5,h=!0),n(2,u=!0);try{if(c.password!==c.passwordConfirmation)return n(3,a="Passwords need to match!"),n(5,h=!1),void n(2,u=!1);const e=O.hashSync(c.password);delete c.passwordConfirmation;const t=yield fetch("/api/user",{method:"POST",body:JSON.stringify(Object.assign(Object.assign({},c),{password:e})),headers:{"Content-Type":"application/json"}});if(!t.ok){const e=yield t.json();throw n(3,a=e.message),n(4,r=null),n(5,h=!1),a}{const e=yield t.json();n(4,r=e.message),n(3,a=null),n(5,h=!1),n(2,u=!1)}}catch(e){console.error(e),n(5,h=!1),n(2,u=!1)}}))},function(){c.username=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.password=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.passwordConfirmation=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.type=N(this),n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.school_id=N(this),n(1,c),n(7,i)},()=>{n(2,u=!1)}]}class F extends e{constructor(e){super(),t(this,e,z,X,n,{schools:0})}}export{F as default,q as load};
