import{S as e,i as t,s as n,l as s,f as a,d as o,e as r,t as l,c,a as i,g as u,V as h,G as d,W as f,H as p,k as m,n as v,h as g,X as y,O as w,b as _,j as x,m as $,Y as C,o as P,x as E,u as O,v as S,P as T,Z as b,_ as j,L as N}from"../../chunks/vendor-dc16c193.js";import{s as I}from"../../chunks/stores-4f8ab6e8.js";import{S as k}from"../../chunks/SubmitButton-561b3d06.js";function U(e,t,n){const s=e.slice();return s[21]=t[n],s}function L(e,t,n){const s=e.slice();return s[24]=t[n],s}function A(e){let t,n,s,h=e[24].text+"";return{c(){t=r("option"),n=l(h),s=m(),this.h()},l(e){t=c(e,"OPTION",{});var a=i(t);n=u(a,h),s=v(a),a.forEach(o),this.h()},h(){t.__value=e[24].value,t.value=t.__value},m(e,o){a(e,t,o),d(t,n),d(t,s)},p:N,d(e){e&&o(t)}}}function H(e){let t,n="null";return{c(){t=l(n)},l(e){t=u(e,n)},m(e,n){a(e,t,n)},p:N,d(e){e&&o(t)}}}function V(e){let t;function n(e,t){return"teacher"===e[6].user.type&&"researcher"===e[24].value?H:A}let r=n(e),l=r(e);return{c(){l.c(),t=s()},l(e){l.l(e),t=s()},m(e,n){l.m(e,n),a(e,t,n)},p(e,s){r===(r=n(e))&&l?l.p(e,s):(l.d(1),l=r(e),l&&(l.c(),l.m(t.parentNode,t)))},d(e){l.d(e),e&&o(t)}}}function B(e){let t,n,s,m,v,g=e[0],_=[];for(let a=0;a<g.length;a+=1)_[a]=D(U(e,g,a));return{c(){t=r("select"),n=r("option"),s=l("Select a school");for(let e=0;e<_.length;e+=1)_[e].c();this.h()},l(e){t=c(e,"SELECT",{});var a=i(t);n=c(a,"OPTION",{});var r=i(n);s=u(r,"Select a school"),r.forEach(o);for(let t=0;t<_.length;t+=1)_[t].l(a);a.forEach(o),this.h()},h(){n.disabled=!0,n.selected=!0,n.__value="",n.value=n.__value,void 0===e[1].school_id&&h((()=>e[17].call(t)))},m(o,r){a(o,t,r),d(t,n),d(n,s);for(let e=0;e<_.length;e+=1)_[e].m(t,null);f(t,e[1].school_id),m||(v=[p(t,"change",e[17]),p(t,"change",e[18])],m=!0)},p(e,n){if(1&n){let s;for(g=e[0],s=0;s<g.length;s+=1){const a=U(e,g,s);_[s]?_[s].p(a,n):(_[s]=D(a),_[s].c(),_[s].m(t,null))}for(;s<_.length;s+=1)_[s].d(1);_.length=g.length}130&n&&f(t,e[1].school_id)},d(e){e&&o(t),y(_,e),m=!1,w(v)}}}function D(e){let t,n,s,h,f=e[21].name+"";return{c(){t=r("option"),n=l(f),s=m(),this.h()},l(e){t=c(e,"OPTION",{});var a=i(t);n=u(a,f),s=v(a),a.forEach(o),this.h()},h(){t.__value=h=e[21]._id,t.value=t.__value},m(e,o){a(e,t,o),d(t,n),d(t,s)},p(e,s){1&s&&f!==(f=e[21].name+"")&&g(n,f),1&s&&h!==(h=e[21]._id)&&(t.__value=h,t.value=t.__value)},d(e){e&&o(t)}}}function G(e){let t;return{c(){t=l("Add user")},l(e){t=u(e,"Add user")},m(e,n){a(e,t,n)},d(e){e&&o(t)}}}function J(e){let t,n;return{c(){t=r("p"),n=l(e[3]),this.h()},l(s){t=c(s,"P",{class:!0});var a=i(t);n=u(a,e[3]),a.forEach(o),this.h()},h(){_(t,"class","text-red-400")},m(e,s){a(e,t,s),d(t,n)},p(e,t){8&t&&g(n,e[3])},d(e){e&&o(t)}}}function R(e){let t,n;return{c(){t=r("p"),n=l(e[4]),this.h()},l(s){t=c(s,"P",{class:!0});var a=i(t);n=u(a,e[4]),a.forEach(o),this.h()},h(){_(t,"class","text-green-500")},m(e,s){a(e,t,s),d(t,n)},p(e,t){16&t&&g(n,e[4])},d(e){e&&o(t)}}}function W(e){let t,n,s,g,T,b,j,N,I,U,A,H,D,W,X,Y,Z,q,z,F=e[7],K=[];for(let a=0;a<F.length;a+=1)K[a]=V(L(e,F,a));let M="researcher"===e[6].user.type&&e[0]&&B(e);W=new k({props:{disabled:e[2],action:e[8],loading:e[5],$$slots:{default:[G]},$$scope:{ctx:e}}});let Q=e[3]&&J(e),ee=e[4]&&R(e);return{c(){t=r("div"),n=r("h1"),s=l("Create new user"),g=m(),T=r("input"),b=m(),j=r("input"),N=m(),I=r("input"),U=m(),A=r("select");for(let e=0;e<K.length;e+=1)K[e].c();H=m(),M&&M.c(),D=m(),x(W.$$.fragment),X=m(),Q&&Q.c(),Y=m(),ee&&ee.c(),this.h()},l(e){t=c(e,"DIV",{class:!0});var a=i(t);n=c(a,"H1",{});var r=i(n);s=u(r,"Create new user"),r.forEach(o),g=v(a),T=c(a,"INPUT",{type:!0,name:!0,placeholder:!0}),b=v(a),j=c(a,"INPUT",{type:!0,name:!0,placeholder:!0}),N=v(a),I=c(a,"INPUT",{type:!0,name:!0,placeholder:!0}),U=v(a),A=c(a,"SELECT",{});var l=i(A);for(let t=0;t<K.length;t+=1)K[t].l(l);l.forEach(o),H=v(a),M&&M.l(a),D=v(a),$(W.$$.fragment,a),X=v(a),Q&&Q.l(a),Y=v(a),ee&&ee.l(a),a.forEach(o),this.h()},h(){_(T,"type","text"),_(T,"name","username"),_(T,"placeholder","Username"),_(j,"type","password"),_(j,"name","username"),_(j,"placeholder","Password"),_(I,"type","password"),_(I,"name","passwordConfirmation"),_(I,"placeholder","Confirm password"),void 0===e[1].type&&h((()=>e[15].call(A))),_(t,"class","flex flex-col md:items-center gap-3")},m(o,r){a(o,t,r),d(t,n),d(n,s),d(t,g),d(t,T),C(T,e[1].username),d(t,b),d(t,j),C(j,e[1].password),d(t,N),d(t,I),C(I,e[1].passwordConfirmation),d(t,U),d(t,A);for(let e=0;e<K.length;e+=1)K[e].m(A,null);f(A,e[1].type),d(t,H),M&&M.m(t,null),d(t,D),P(W,t,null),d(t,X),Q&&Q.m(t,null),d(t,Y),ee&&ee.m(t,null),Z=!0,q||(z=[p(T,"input",e[9]),p(T,"change",e[10]),p(j,"input",e[11]),p(j,"change",e[12]),p(I,"input",e[13]),p(I,"change",e[14]),p(A,"change",e[15]),p(A,"change",e[16])],q=!0)},p(e,[n]){if(130&n&&T.value!==e[1].username&&C(T,e[1].username),130&n&&j.value!==e[1].password&&C(j,e[1].password),130&n&&I.value!==e[1].passwordConfirmation&&C(I,e[1].passwordConfirmation),192&n){let t;for(F=e[7],t=0;t<F.length;t+=1){const s=L(e,F,t);K[t]?K[t].p(s,n):(K[t]=V(s),K[t].c(),K[t].m(A,null))}for(;t<K.length;t+=1)K[t].d(1);K.length=F.length}130&n&&f(A,e[1].type),"researcher"===e[6].user.type&&e[0]?M?M.p(e,n):(M=B(e),M.c(),M.m(t,D)):M&&(M.d(1),M=null);const s={};4&n&&(s.disabled=e[2]),32&n&&(s.loading=e[5]),134217728&n&&(s.$$scope={dirty:n,ctx:e}),W.$set(s),e[3]?Q?Q.p(e,n):(Q=J(e),Q.c(),Q.m(t,Y)):Q&&(Q.d(1),Q=null),e[4]?ee?ee.p(e,n):(ee=R(e),ee.c(),ee.m(t,null)):ee&&(ee.d(1),ee=null)},i(e){Z||(E(W.$$.fragment,e),Z=!0)},o(e){O(W.$$.fragment,e),Z=!1},d(e){e&&o(t),y(K,e),M&&M.d(),S(W),Q&&Q.d(),ee&&ee.d(),q=!1,w(z)}}}var X=function(e,t,n,s){return new(n||(n=Promise))((function(a,o){function r(e){try{c(s.next(e))}catch(t){o(t)}}function l(e){try{c(s.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((s=s.apply(e,t||[])).next())}))};const Y=({session:e})=>X(void 0,void 0,void 0,(function*(){if(!e.user||"student"===e.user.type)return{status:302,redirect:"/login"};if("researcher"===e.user.type)try{const e=yield fetch("/api/school");if(e.ok){return{props:{schools:(yield e.json()).schools}}}}catch(t){console.error(t)}return{}}));function Z(e,t,n){let s;T(e,I,(e=>n(6,s=e)));var a=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))((function(a,o){function r(e){try{c(s.next(e))}catch(t){o(t)}}function l(e){try{c(s.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,l)}c((s=s.apply(e,t||[])).next())}))};let o,r,{schools:l}=t,c={username:"",password:"",passwordConfirmation:"",type:"student",school_id:null},i=[{value:"student",text:"Student"},{value:"teacher",text:"Teacher"},{value:"researcher",text:"Researcher"}],u=!1,h=!1;return e.$$set=e=>{"schools"in e&&n(0,l=e.schools)},[l,c,u,o,r,h,s,i,function(){return a(this,void 0,void 0,(function*(){n(3,o=void 0),n(5,h=!0),n(2,u=!0);try{if(c.password!==c.passwordConfirmation)return n(3,o="Passwords need to match!"),n(5,h=!1),void n(2,u=!1);const e=b.hashSync(c.password);delete c.passwordConfirmation;const t=yield fetch("/api/user",{method:"POST",body:JSON.stringify(Object.assign(Object.assign({},c),{password:e})),headers:{"Content-Type":"application/json"}});if(!t.ok){const e=yield t.json();throw n(3,o=e.message),n(4,r=null),n(5,h=!1),o}{const e=yield t.json();n(4,r=e.message),n(3,o=null),n(5,h=!1),n(2,u=!1)}}catch(e){console.error(e),n(5,h=!1),n(2,u=!1)}}))},function(){c.username=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.password=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.passwordConfirmation=this.value,n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.type=j(this),n(1,c),n(7,i)},()=>{n(2,u=!1)},function(){c.school_id=j(this),n(1,c),n(7,i)},()=>{n(2,u=!1)}]}class q extends e{constructor(e){super(),t(this,e,Z,W,n,{schools:0})}}export{q as default,Y as load};
