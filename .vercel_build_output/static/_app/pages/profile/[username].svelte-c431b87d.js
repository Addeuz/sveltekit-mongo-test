import{S as t,i as e,s as n,e as o,t as a,k as s,c,a as r,g as i,d as l,n as u,b as h,f as d,G as f,V as v,H as p,N as m,l as y,h as b,L as g,W as w,A as x}from"../../chunks/vendor-be9b7230.js";import{s as k}from"../../chunks/stores-a77e6bb1.js";function T(t){let e,n,y,b,g,w,x,k,T,N;return{c(){e=o("h1"),n=a("Create new school"),y=s(),b=o("div"),g=o("input"),w=s(),x=o("button"),k=a("Create school"),this.h()},l(t){e=c(t,"H1",{class:!0});var o=r(e);n=i(o,"Create new school"),o.forEach(l),y=u(t),b=c(t,"DIV",{class:!0});var a=r(b);g=c(a,"INPUT",{type:!0,placeholder:!0}),w=u(a),x=c(a,"BUTTON",{class:!0});var s=r(x);k=i(s,"Create school"),s.forEach(l),a.forEach(l),this.h()},h(){h(e,"class","mt-4"),h(g,"type","text"),h(g,"placeholder","School name"),h(x,"class","bg-blue-300 p-4 rounded"),h(b,"class","flex items-center gap-4")},m(o,a){d(o,e,a),f(e,n),d(o,y,a),d(o,b,a),f(b,g),v(g,t[1]),f(b,w),f(b,x),f(x,k),T||(N=[p(g,"input",t[4]),p(x,"click",t[3])],T=!0)},p(t,e){2&e&&g.value!==t[1]&&v(g,t[1])},d(t){t&&l(e),t&&l(y),t&&l(b),T=!1,m(N)}}}function N(t){var e;let n,v,m,w,x,k,N,P,E,H,O=(t[0]?t[0].username:"")+"",S="researcher"===(null==(e=t[0])?void 0:e.type)&&T(t);return{c(){n=o("h1"),v=a("Hello, "),m=a(O),w=s(),x=o("button"),k=a("Logout"),N=s(),S&&S.c(),P=y(),this.h()},l(t){n=c(t,"H1",{});var e=r(n);v=i(e,"Hello, "),m=i(e,O),e.forEach(l),w=u(t),x=c(t,"BUTTON",{class:!0});var o=r(x);k=i(o,"Logout"),o.forEach(l),N=u(t),S&&S.l(t),P=y(),this.h()},h(){h(x,"class","bg-red-300 p-4 rounded")},m(e,o){d(e,n,o),f(n,v),f(n,m),d(e,w,o),d(e,x,o),f(x,k),d(e,N,o),S&&S.m(e,o),d(e,P,o),E||(H=p(x,"click",t[2]),E=!0)},p(t,[e]){var n;1&e&&O!==(O=(t[0]?t[0].username:"")+"")&&b(m,O),"researcher"===(null==(n=t[0])?void 0:n.type)?S?S.p(t,e):(S=T(t),S.c(),S.m(P.parentNode,P)):S&&(S.d(1),S=null)},i:g,o:g,d(t){t&&l(n),t&&l(w),t&&l(x),t&&l(N),S&&S.d(t),t&&l(P),E=!1,H()}}}var P=function(t,e,n,o){return new(n||(n=Promise))((function(a,s){function c(t){try{i(o.next(t))}catch(e){s(e)}}function r(t){try{i(o.throw(t))}catch(e){s(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,r)}i((o=o.apply(t,e||[])).next())}))};const E=({session:t})=>P(void 0,void 0,void 0,(function*(){return t.authenticated?{}:{status:302,redirect:"/login"}}));function H(t,e,n){let o;w(t,k,(t=>n(6,o=t)));var a=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(a,s){function c(t){try{i(o.next(t))}catch(e){s(e)}}function r(t){try{i(o.throw(t))}catch(e){s(e)}}function i(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,r)}i((o=o.apply(t,e||[])).next())}))};let s,c,r;return x((()=>{n(0,c=o.user)})),[c,r,function(){return a(this,void 0,void 0,(function*(){try{const t=yield fetch("/api/auth/logout",{method:"POST"});if(!t.ok){const e=yield t.json();throw s=e.message,s}location.reload()}catch(t){}}))},function(){return a(this,void 0,void 0,(function*(){if(""!==r&&void 0!==r)try{const t=yield fetch("/api/school",{method:"POST",body:JSON.stringify({name:r})});if(t.ok){const e=yield t.json();alert(e.message),n(1,r="")}}catch(t){}else alert("Please enter a school name.")}))},function(){r=this.value,n(1,r)}]}class O extends t{constructor(t){super(),e(this,t,H,N,n,{})}}export{O as default,E as load};
